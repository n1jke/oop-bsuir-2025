@startuml lr2-architecture
skinparam classAttributeIconSize 0

namespace domain {
class Account
class SavingsAccount
class CreditAccount
class BonusProgram
class Transaction
class Event
class Money
}

namespace "application/services" as app_services {
interface PaymentAccount {
  +ID(): uuid.UUID
  +ClientID(): uuid.UUID
  +Balance(): domain.Money
  +Deposit(money): error
  +Withdraw(money): error
}

interface Storage<K, V> {
  +Save(k, v): error
  +ByID(k): (V, error)
  +Delete(k): error
}

interface AccountStorage {
  +Save(accountID, account): error
  +ByID(accountID): (PaymentAccount, error)
  +UpdateStatus(accountID, status): error
}

interface EventStorage {
  +Save(id, event): error
  +QueryAll(): []*Event
}

class PaymentService
}

namespace application {
class TransferUseCase
class BonusRedeemUseCase
}

namespace infrastructure {
class CacheStorage<K, V>
class AccountCache
class EventCache
}

domain.SavingsAccount --|> domain.Account
domain.CreditAccount --|> domain.Account
domain.SavingsAccount *-- domain.BonusProgram

app_services.PaymentAccount <|.. domain.Account
app_services.PaymentAccount <|.. domain.SavingsAccount
app_services.PaymentAccount <|.. domain.CreditAccount

app_services.AccountStorage <|.. infrastructure.AccountCache
app_services.EventStorage <|.. infrastructure.EventCache
infrastructure.AccountCache *-- infrastructure.CacheStorage
infrastructure.EventCache *-- infrastructure.CacheStorage

app_services.PaymentService --> app_services.AccountStorage

application.TransferUseCase --> app_services.PaymentService
application.TransferUseCase --> app_services.EventStorage
application.TransferUseCase ..> domain.Transaction

application.BonusRedeemUseCase --> app_services.AccountStorage
application.BonusRedeemUseCase --> app_services.EventStorage
application.BonusRedeemUseCase ..> domain.SavingsAccount
@enduml
