@startuml classDiagram

class Client {
  -clientUUID: uuid.UUID
  -Person: Person
  -accounts: []AccountRef
  +ClientUUID(): uuid.UUID
  +AddAccount(account: AccountRef)
  +Accounts(): []AccountRef
}

class Person {
  -firstname: string
  -lastname: string
  -surname: string
  -birthdayDate: time.Time
}

interface AccountRef {
  +AccountUUID(): uuid.UUID
}

class Transaction {
  -id: int
  -srcAccountUUID: uuid.UUID
  -destAccountUUID: uuid.UUID
  -status: PaymentStatus
  -value: Money
  -txType: TransactionType
  +ID(): int
  +SourceAccountUUID(): uuid.UUID
  +DestinationAccountUUID(): uuid.UUID
  +Status(): PaymentStatus
  +Value(): Money
  +Type(): TransactionType
  +SetStatus(status: PaymentStatus)
}

enum PaymentStatus {
  Initiated
  Pending
  Declined
  Failed
  Completed
}

enum TransactionType {
  Transfer
  Deposit
  Withdraw
}

class Money {
  -amount: int
  -curr: Currency
  +NewMoney(amount: int, curr: Currency): Money
  +Amount(): int
  +Currency(): Currency
  +Add(other: Money): Money
  +Sub(other: Money): Money
}

class Currency {}

class Event {
  -Name: string
  -AccountUUID: uuid.UUID
  -OccurredAt: time.Time
}

class BonusProgram {
  -points: int
  -tier: BonusTier
  +NewBonusProgram(tier: BonusTier): BonusProgram
  +Accrue(value: Money)
  +ApplyBonus(points: int): bool
  +Bonus(): int
}

enum BonusTier {
  Bronze
  Silver
  Gold
}

class Account {
  -userUUID: uuid.UUID
  -accountUUID: uuid.UUID
  -status: AccountStatus
  -balance: Money
  +UserUUID(): uuid.UUID
  +AccountUUID(): uuid.UUID
  +Status(): AccountStatus
  +SetStatus(status: AccountStatus)
  +Balance(): Money
  +Deposit(value: Money)
  +Withdraw(value: Money): bool
  +CanWithdraw(value: Money): bool
}

enum AccountStatus {
  Active
  Frozen
  Closed
}

class CheckingAccount {}

class SavingsAccount {
  +BonusProgram: BonusProgram
  +Deposit(value: Money)
}

class BonusAccount {
  -bonusMultiplier: int
  +Deposit(value: Money)
}

class CreditAccount {
  -overdraftLimit: Money
  +CanWithdraw(value: Money): bool
}

interface PaymentAccount {
  +UserUUID(): uuid.UUID
  +AccountUUID(): uuid.UUID
  +Status(): AccountStatus
  +Balance(): Money
  +Deposit(m: Money)
  +Withdraw(m: Money): bool
  +CanWithdraw(m: Money): bool
  +SetStatus(s: AccountStatus)
}

interface PaymentService {
  +Deposit(m: Money, aUUID: uuid.UUID): error
  +Withdraw(m: Money, aUUID: uuid.UUID): error
  +ProcessTransaction(t: Transaction): error
}

interface AccountRepository {
  +Create(a: PaymentAccount): error
  +ChangeStatus(aUUID: uuid.UUID, s: AccountStatus): error
  +ByUUID(aUUID: uuid.UUID): (PaymentAccount, error)
}

interface EventService {
  +Publish(e: Event): error
  +QueryAll(): []Event
}

Client *-- Person : composition
Client o-- AccountRef : accounts

SavingsAccount *-- BonusProgram : composition
Account *-- Money : composition
Transaction *-- Money : composition

Account ..|> AccountRef
Account ..|> PaymentAccount

Account <|-- CheckingAccount
Account <|-- SavingsAccount
SavingsAccount <|-- BonusAccount
Account <|-- CreditAccount

Transaction --> Account : src/dest UUID

@enduml
